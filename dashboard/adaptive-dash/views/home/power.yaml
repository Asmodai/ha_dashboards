type: custom:grid-layout
title: Power
square: false
layout:
  width: 250
  max-width: 250
  height: 88%
  grid-width: 250
  grid-max-width: 250
  grid-item--max-width: 250
  grid-template-columns: 1fr 1fr fit-content(1fr)
  grid-template-rows:    auto auto fit-content(20%)
  grid-template-areas: |
    "main  main   main"
    "graph graph  graph"
    "alarm footer notices"
  justify-items: stretch
  justify-self: stretch
icon: mdi:home-lightning-bolt-outline
path: home_power
visible: false
badges: []
card_mod:
  style:
    .: |
      margin: 0px;
background: >-
  center / cover no-repeat fixed
  url('/local/PurpleAbstractDark.png')
cards:

##
## MAIN

  - view_layout:
      grid-area: main
    type: grid
    columns: 5
    square: false
    cards:
    
      - view_layout:
          column: 1
        type:     custom:button-card
        template: card_asmodai_sensor_graph_pct
        entity:   sensor.electricity_maps_grid_fossil_fuel_percentage
        variables:
          name:   "Carbon"
    
      - view_layout:
          column: 2
        type:     custom:button-card
        template: card_asmodai_sensor_graph_kwh
        entity:   sensor.dcc_sourced_smart_electricity_meter_usage_today
        variables:
          name:   "Electricity Usage"
          
      - view_layout:
          column: 3
        type:     custom:button-card
        template: card_asmodai_sensor_graph_cost
        entity:   sensor.dcc_sourced_smart_electricity_meter_cost_today
        variables:
          name:   "Electricity Cost"
          
      - view_layout:
          column: 4
        type:     custom:button-card
        template: card_asmodai_sensor_graph_kwh
        entity:   sensor.dcc_sourced_smart_gas_meter_usage_today
        variables:
          name:   "Gas Usage"
          
      - view_layout:
          column: 5
        type:     custom:button-card
        template: card_asmodai_sensor_graph_cost
        entity:   sensor.dcc_sourced_smart_gas_meter_cost_today
        variables:
          name:   "Gas Cost"

  - view_layout:
      grid-area: graph
    type: vertical-stack
    cards:
#      - type: energy-date-selection
#        card_mod:
#          style:
#            .: |
#              ha-card {
#                background-color: transparent;
#              }
      - type: custom:sankey-chart
        card_mod:
          style:
            .: |
              ha-card {
                background-color: transparent;
              }
        show_states:           true
        show_names:            true
        show_units:            true
#        energy_date_selection: true
        min_state:             0
        min_box_height:        22
        in_box_distance:       5
        round:                 1
        unit_prefix:           "k"
        wide:                  true
        sections:
          - sort_by: "state"
            entities:
            - entity_id: sensor.dcc_sourced_smart_electricity_meter_usage_today
              name: Grid
              type: entity
              color: var(--warning-color)
              sort_by: "state"
              children:
                - total_usage

          - sort_by: "state"
            entities:
            - entity_id: total_usage
              type: remaining_parent_state
              name: Total Usage
              tap_action:
                action: none
              children:
                - office
                - other

          - sort_by: "state"
            entities:
            - entity_id: office
              type: remaining_child_state
              name: Office
              color: purple
              tap_action:
                action: none
              children:
                - office_wall_plugs
            - entity_id: other
              type: remaining_parent_state
              name: Other
              color: red
              tap_action:
                action: none
              children: []

          - sort_by: "state"
            entities:
            - entity_id: office_wall_plugs
              type: remaining_child_state
              name: Wall Plugs
              color: purple
              tap_action:
                action: none
              children:
                - sensor.fibaro_wall_plug_1_utility_meter
                - sensor.fibaro_wall_plug_2_utility_meter

          - sort_by: "state"
            entities:
            - entity_id: sensor.fibaro_wall_plug_1_utility_meter
              type: entity
              name: "Wall Plug #1"
              color: purple
              children: []
            - entity_id: sensor.fibaro_wall_plug_2_utility_meter
              type: entity
              name: "Wall Plug #2"
              color: purple
              children: []

  #
  # Alarm area.
  #
  - !include "../../includes/alarm.yaml"

  #
  # Notices area.
  #
  - !include "../../includes/notices.yaml"

  #
  # Footer area.
  #
  - view_layout:
      grid-area: footer
    type: custom:mod-card
    card:
      type: custom:button-card
      template: card_asmodai_tablet_menu
      variables:
        element_1: # Information
          icon: mdi:information-outline
          path: "home_info"
        element_2: # Alarm
          icon:  mdi:shield-home-outline
          path: "home_alarm"
        element_3: # Doorbell
          icon: mdi:doorbell-video
          path: "home_door"
        element_4: # CCTV
          icon: mdi:cctv
          path: "home_cctv"
        element_5: # Security
          icon: mdi:home-lightning-bolt-outline
          path: "home_power"
          active: true
        element_6: # Calendar
          icon: mdi:calendar-month-outline
          path: "home_events"
        element_7: # Shopping
          icon: mdi:cart-outline
          path: "home_todo"
        element_8: # Menu
          icon: mdi:menu
          path: "home_settings"
    card_mod:
      style:
        .: |
          ha-card {
            width: 600px;
            margin:auto;
            position: absolute;
            bottom: 0%;
            left: 0;
            right: 0;
            height: 70px;
            z-index: 5;
          }
